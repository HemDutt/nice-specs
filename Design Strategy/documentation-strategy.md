# Documentation Strategy for `@nicespecs`

This guide defines the canonical structure, content flow, and metadata captured in every documentation file generated by the extension. Consistency here ensures humans and coding agents can rely on the docs as the single source of truth.

## 1. File Naming & Placement
- **Naming**: `nicespecs.<component-name>.md`, where `<component-name>` is the lowercase, kebab-cased folder name (`History` → `nicespecs.history.md`).
- **Location**: stored directly inside the folder it documents, keeping doc + code co-located.
- **Indexing**: `.nicespecs/index.json` maps components to paths, timestamps, child references, and cost metadata.

## 2. Frontmatter Metadata
Each doc starts with YAML frontmatter to aid automation and search:
```yaml
component: history
path: src/features/History
lastUpdated: 2025-01-15T12:34:56Z
parents:
  - nicespecs.features.md
children:
  - nicespecs.history.api.md
  - nicespecs.history.storage.md
tags:
  - domain:communications
  - layer:service
```

## 3. Markdown Outline

Each doc starts with a concise (2–3 sentence) summary of the component’s scope, ownership, and integration boundaries so readers can understand the entire folder before diving into sections.

1. `# Component Name`
2. `## Purpose`
3. `## Responsibilities`
4. `## Code Structure`
   - Begin with a short synopsis that connects the files, highlighting how control flows across the folder.
   - Include a file inventory table that lists every code file in the component folder, plus the primary classes/structs/enums defined within; add one-line descriptions for each symbol so the structure can be skimmed without opening the file.
   - One subsection per local file (e.g., `### HistoryService.ts`) follows the table, reiterating ownership details, detailing important methods, and pointing to inline references (e.g., `` `HistoryService` ``) and chunk identifiers.
   - As you enumerate files and symbols, persist the mapping (`component path → file → symbol type/name → chunk id`) to the SQLite Key Mapper (or corresponding embedding index) so documentation search and agent queries can instantly answer “where is X defined?”.
5. `## Data Flow & Interactions`
   - Explain how the component communicates with services, databases, or external APIs.
   - Highlight sequence or state transitions.
6. `## Dependencies`
   - Split into `Internal` (other modules in repo) and `External` (packages, services).
7. `## Child Components`
   - Bullet list of child folders with descriptions.
   - Each entry includes a hyperlink to the child doc, e.g., `- [ History Storage](./storage/nicespecs.history.storage.md): persists records in PostgreSQL.`
8. `## Operational Notes`
   - Deployment concerns, configuration flags, feature toggles.
9. `## Risks & TODOs`
   - Known gaps, tech debt, follow-up questions.
10. `## Changelog`
    - Short log of major doc updates with timestamps and reason.

## 4. Content Rules
- **Local-first detail**: All deep explanations focus on files within the current folder. Child relationships are summarized with links; parent docs never duplicate child internals.
- **Evidence linking**: Each factual statement references the originating file (and optional line range or chunk id), e.g., `_See `HistoryService.ts#chunk-3` for batching logic._`
- **Terminology normalization**: Use consistent labels for recurring systems (e.g., “ Record”, “Notification Service”) to keep search results predictable.
- **Tone**: Declarative, concise sentences. Avoid speculative language; mark unknowns explicitly in `Risks & TODOs`.

## 5. Visual & Tabular Elements
- Inline sequence diagrams or tables may appear under `Data Flow` when useful, but they must be derived from code evidence.
- Example table:
  | Endpoint | Description | Source |
  |----------|-------------|--------|
  | `POST /users/{id}/history` | Creates a history entry | `HistoryApi.ts#chunk-2` |

## 6. Linking Strategy
- Use relative paths (`./child/nicespecs.child.md`) so docs remain valid across machines.
- Parent docs reference all direct children; root doc references every top-level component.
- When referencing external specs or ADRs, include absolute URLs or repository-relative paths (`../docs/adr-001.md`).

## 7. Versioning & Incremental Updates
- `Changelog` entries capture doc updates triggered by code changes (auto-generated summary + reviewer note).
- `.nicespecs/index.json` stores `lastRun` timestamps per component so incremental runs know which docs require refresh.

## 8. Validation Checklist (applied by QualityReviewer)
- Frontmatter present and valid YAML.
- Required headers exist in order.
- All child references include hyperlinks and short descriptions.
- No references to non-existent files or outdated paths.
- `Risks & TODOs` explicitly state uncertainties rather than implying certainty.
- Changelog contains at least one entry after the first successful run.

Following this strategy guarantees every documentation artifact is predictable, link-rich, and ready for both human consumption and automated reasoning. No code implementation occurs until this structure is approved.
